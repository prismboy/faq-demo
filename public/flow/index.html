<html>
<meta charset="utf-8">
<head>
<title>FQAデモアプリ・フロー</title>
</head>
<body>
<br>
<font size="+2"><b>FAQデモアプリのNode-RED フロー</b></font>
<br><br>
<b>&lt;Flow 1 : 回答データの登録&gt;</b><br>
<font color="red"><b>========================= ↓ここから↓ =========================</b></font><br>
[{&quot;id&quot;:&quot;99c7967.88da368&quot;,&quot;type&quot;:&quot;function&quot;,&quot;z&quot;:&quot;61cb938d.c50b0c&quot;,&quot;name&quot;:&quot;回答データ定義&quot;,&quot;func&quot;:&quot;context.global.payload=[\n// このブラケット内([ ])に回答データをJSON形式で定義してください。\n// JSON例\n// { \&quot;class_name\&quot; : \&quot;faq-id01\&quot;, \&quot;answer\&quot; : \&quot;ここに回答を設定する。\&quot;, \&quot;ref_url\&quot; : \&quot;http://～～～(ブランク可)\&quot;},\n];\nmsg.payload = context.global.payload.length;\ncontext.global.count = context.global.payload.length;\ncontext.global.unitCnt = 0;\nreturn msg;\n&quot;,&quot;outputs&quot;:1,&quot;noerr&quot;:0,&quot;x&quot;:358,&quot;y&quot;:150.5,&quot;wires&quot;:[[&quot;74c43ef5.acd7b8&quot;]]},{&quot;id&quot;:&quot;d2d5c1a8.34af7&quot;,&quot;type&quot;:&quot;inject&quot;,&quot;z&quot;:&quot;61cb938d.c50b0c&quot;,&quot;name&quot;:&quot;データ登録&quot;,&quot;topic&quot;:&quot;&quot;,&quot;payload&quot;:&quot;&quot;,&quot;payloadType&quot;:&quot;date&quot;,&quot;repeat&quot;:&quot;&quot;,&quot;crontab&quot;:&quot;&quot;,&quot;once&quot;:false,&quot;x&quot;:118,&quot;y&quot;:150.5,&quot;wires&quot;:[[&quot;99c7967.88da368&quot;]]},{&quot;id&quot;:&quot;74c43ef5.acd7b8&quot;,&quot;type&quot;:&quot;switch&quot;,&quot;z&quot;:&quot;61cb938d.c50b0c&quot;,&quot;name&quot;:&quot;&quot;,&quot;property&quot;:&quot;payload&quot;,&quot;propertyType&quot;:&quot;msg&quot;,&quot;rules&quot;:[{&quot;t&quot;:&quot;eq&quot;,&quot;v&quot;:&quot;0&quot;,&quot;vt&quot;:&quot;num&quot;},{&quot;t&quot;:&quot;gt&quot;,&quot;v&quot;:&quot;0&quot;,&quot;vt&quot;:&quot;num&quot;}],&quot;checkall&quot;:&quot;true&quot;,&quot;outputs&quot;:2,&quot;x&quot;:648,&quot;y&quot;:210.5,&quot;wires&quot;:[[&quot;d5edb416.6f5878&quot;],[&quot;d784ae93.33063&quot;]]},{&quot;id&quot;:&quot;d784ae93.33063&quot;,&quot;type&quot;:&quot;function&quot;,&quot;z&quot;:&quot;61cb938d.c50b0c&quot;,&quot;name&quot;:&quot;1件登録&quot;,&quot;func&quot;:&quot;msg.payload = context.global.payload[context.global.count-1];\ncontext.global.count = context.global.count - 1;\ncontext.global.unitCnt += 1;\nreturn msg;&quot;,&quot;outputs&quot;:1,&quot;noerr&quot;:0,&quot;x&quot;:798,&quot;y&quot;:250.5,&quot;wires&quot;:[[&quot;19198241.74ab26&quot;,&quot;ba8f5ce7.bddd58&quot;]]},{&quot;id&quot;:&quot;d5edb416.6f5878&quot;,&quot;type&quot;:&quot;debug&quot;,&quot;z&quot;:&quot;61cb938d.c50b0c&quot;,&quot;name&quot;:&quot;終了&quot;,&quot;active&quot;:true,&quot;console&quot;:&quot;false&quot;,&quot;complete&quot;:&quot;payload&quot;,&quot;x&quot;:808,&quot;y&quot;:130.5,&quot;wires&quot;:[]},{&quot;id&quot;:&quot;63e9287e.52022&quot;,&quot;type&quot;:&quot;function&quot;,&quot;z&quot;:&quot;61cb938d.c50b0c&quot;,&quot;name&quot;:&quot;Fetch&quot;,&quot;func&quot;:&quot;msg.payload = context.global.count;\nreturn msg;&quot;,&quot;outputs&quot;:1,&quot;noerr&quot;:0,&quot;x&quot;:548,&quot;y&quot;:290.5,&quot;wires&quot;:[[&quot;74c43ef5.acd7b8&quot;]]},{&quot;id&quot;:&quot;19198241.74ab26&quot;,&quot;type&quot;:&quot;cloudant out&quot;,&quot;z&quot;:&quot;61cb938d.c50b0c&quot;,&quot;name&quot;:&quot;&quot;,&quot;cloudant&quot;:&quot;&quot;,&quot;database&quot;:&quot;faq-answer&quot;,&quot;service&quot;:&quot;faq-demo-cloudantNoSQLDB&quot;,&quot;payonly&quot;:true,&quot;operation&quot;:&quot;insert&quot;,&quot;x&quot;:988,&quot;y&quot;:250.5,&quot;wires&quot;:[]},{&quot;id&quot;:&quot;f275d403.3a6f88&quot;,&quot;type&quot;:&quot;comment&quot;,&quot;z&quot;:&quot;61cb938d.c50b0c&quot;,&quot;name&quot;:&quot;0. FAQの回答を登録します。&quot;,&quot;info&quot;:&quot;&quot;,&quot;x&quot;:150,&quot;y&quot;:84,&quot;wires&quot;:[]},{&quot;id&quot;:&quot;ba8f5ce7.bddd58&quot;,&quot;type&quot;:&quot;delay&quot;,&quot;z&quot;:&quot;61cb938d.c50b0c&quot;,&quot;name&quot;:&quot;&quot;,&quot;pauseType&quot;:&quot;delay&quot;,&quot;timeout&quot;:&quot;110&quot;,&quot;timeoutUnits&quot;:&quot;milliseconds&quot;,&quot;rate&quot;:&quot;1&quot;,&quot;nbRateUnits&quot;:&quot;1&quot;,&quot;rateUnits&quot;:&quot;second&quot;,&quot;randomFirst&quot;:&quot;1&quot;,&quot;randomLast&quot;:&quot;5&quot;,&quot;randomUnits&quot;:&quot;seconds&quot;,&quot;drop&quot;:false,&quot;x&quot;:388,&quot;y&quot;:290.5,&quot;wires&quot;:[[&quot;63e9287e.52022&quot;]]}]
<br>
<font color="red"><b>========================= ↑ここまで↑ =========================</b></font>
<br><br>
<b>&lt;Flow 2 : FAQ応答チャット&gt;</b><br>
<font color="red"><b>========================= ↓ここから↓ =========================</b></font><br>
[{&quot;id&quot;:&quot;6060aadb.84d644&quot;,&quot;type&quot;:&quot;http in&quot;,&quot;z&quot;:&quot;3a005176.5f5df6&quot;,&quot;name&quot;:&quot;&quot;,&quot;url&quot;:&quot;/faq&quot;,&quot;method&quot;:&quot;get&quot;,&quot;swaggerDoc&quot;:&quot;&quot;,&quot;x&quot;:81,&quot;y&quot;:103,&quot;wires&quot;:[[&quot;bd150fcf.ce83f8&quot;]]},{&quot;id&quot;:&quot;6b314712.480338&quot;,&quot;type&quot;:&quot;http response&quot;,&quot;z&quot;:&quot;3a005176.5f5df6&quot;,&quot;name&quot;:&quot;&quot;,&quot;x&quot;:471,&quot;y&quot;:103,&quot;wires&quot;:[]},{&quot;id&quot;:&quot;7d8182d7.e6529c&quot;,&quot;type&quot;:&quot;comment&quot;,&quot;z&quot;:&quot;3a005176.5f5df6&quot;,&quot;name&quot;:&quot;2. ユーザーからの入力受け付け&quot;,&quot;info&quot;:&quot;&quot;,&quot;x&quot;:141,&quot;y&quot;:203,&quot;wires&quot;:[]},{&quot;id&quot;:&quot;7d783be7.c2ed6c&quot;,&quot;type&quot;:&quot;http in&quot;,&quot;z&quot;:&quot;3a005176.5f5df6&quot;,&quot;name&quot;:&quot;&quot;,&quot;url&quot;:&quot;/faq&quot;,&quot;method&quot;:&quot;post&quot;,&quot;swaggerDoc&quot;:&quot;&quot;,&quot;x&quot;:81,&quot;y&quot;:263,&quot;wires&quot;:[[&quot;5f42a286.73ddac&quot;]]},{&quot;id&quot;:&quot;8e249832.caeb8&quot;,&quot;type&quot;:&quot;function&quot;,&quot;z&quot;:&quot;3a005176.5f5df6&quot;,&quot;name&quot;:&quot;データの形式&quot;,&quot;func&quot;:&quot;if(msg.payload.length !== 0){\n    msg.answer = msg.payload[0].answer; // .replace(/\\\\n/g,\&quot;&lt;br /&gt;\&quot;);\n    msg.ref_url = msg.payload[0].ref_url;\n}else{\n    msg.answer = '申し訳ございません。回答が見つかりません。';\n    msg.ref_url = \&quot;\&quot;;\n}\nmsg.confidence = Math.round(context.global.confidence*100)/100;\n\nreturn msg;&quot;,&quot;outputs&quot;:1,&quot;noerr&quot;:0,&quot;x&quot;:491,&quot;y&quot;:443,&quot;wires&quot;:[[&quot;5b273f6.865a34&quot;]]},{&quot;id&quot;:&quot;5b273f6.865a34&quot;,&quot;type&quot;:&quot;template&quot;,&quot;z&quot;:&quot;3a005176.5f5df6&quot;,&quot;name&quot;:&quot;レスポンスの定義&quot;,&quot;field&quot;:&quot;payload&quot;,&quot;fieldType&quot;:&quot;msg&quot;,&quot;format&quot;:&quot;handlebars&quot;,&quot;syntax&quot;:&quot;mustache&quot;,&quot;template&quot;:&quot;{\n    \&quot;response\&quot; : \&quot;{{answer}}\&quot;,\n    \&quot;confidence\&quot; : \&quot;{{confidence}}\&quot;,\n    \&quot;ref_url\&quot; : \&quot;{{ref_url}}\&quot;\n}&quot;,&quot;x&quot;:691,&quot;y&quot;:443,&quot;wires&quot;:[[&quot;6333a4ed.943d2c&quot;,&quot;e856fe3d.a60768&quot;]]},{&quot;id&quot;:&quot;6333a4ed.943d2c&quot;,&quot;type&quot;:&quot;http response&quot;,&quot;z&quot;:&quot;3a005176.5f5df6&quot;,&quot;name&quot;:&quot;&quot;,&quot;x&quot;:871,&quot;y&quot;:443,&quot;wires&quot;:[]},{&quot;id&quot;:&quot;6955fd67.114c7c&quot;,&quot;type&quot;:&quot;cloudant in&quot;,&quot;z&quot;:&quot;3a005176.5f5df6&quot;,&quot;name&quot;:&quot;&quot;,&quot;cloudant&quot;:&quot;&quot;,&quot;database&quot;:&quot;faq-answer&quot;,&quot;service&quot;:&quot;faq-demo-cloudantNoSQLDB&quot;,&quot;search&quot;:&quot;_idx_&quot;,&quot;design&quot;:&quot;index&quot;,&quot;index&quot;:&quot;byClassName&quot;,&quot;x&quot;:711,&quot;y&quot;:363,&quot;wires&quot;:[[&quot;8e249832.caeb8&quot;,&quot;2992e793.436a7&quot;]]},{&quot;id&quot;:&quot;79c4fd25.aa9014&quot;,&quot;type&quot;:&quot;watson-natural-language-classifier&quot;,&quot;z&quot;:&quot;3a005176.5f5df6&quot;,&quot;name&quot;:&quot;質問内容判定&quot;,&quot;mode&quot;:&quot;classify&quot;,&quot;language&quot;:&quot;en&quot;,&quot;classifier&quot;:&quot;&quot;,&quot;x&quot;:501,&quot;y&quot;:263,&quot;wires&quot;:[[&quot;8e2fe5ae.77012&quot;,&quot;f29f6cd.392951&quot;]]},{&quot;id&quot;:&quot;5f42a286.73ddac&quot;,&quot;type&quot;:&quot;function&quot;,&quot;z&quot;:&quot;3a005176.5f5df6&quot;,&quot;name&quot;:&quot;入力テキスト受け渡し&quot;,&quot;func&quot;:&quot;context.global.input_text =  msg.payload.input_text;\nmsg.payload = msg.payload.input_text;\nreturn msg;&quot;,&quot;outputs&quot;:1,&quot;noerr&quot;:0,&quot;x&quot;:281,&quot;y&quot;:263,&quot;wires&quot;:[[&quot;79c4fd25.aa9014&quot;]]},{&quot;id&quot;:&quot;93dbe863.317ff8&quot;,&quot;type&quot;:&quot;function&quot;,&quot;z&quot;:&quot;3a005176.5f5df6&quot;,&quot;name&quot;:&quot;回答クラスのセット&quot;,&quot;func&quot;:&quot;msg.payload = \&quot;class_name:\&quot; + msg.payload;\nreturn msg;&quot;,&quot;outputs&quot;:1,&quot;noerr&quot;:0,&quot;x&quot;:511,&quot;y&quot;:363,&quot;wires&quot;:[[&quot;6955fd67.114c7c&quot;]]},{&quot;id&quot;:&quot;f3eac1a5.ec332&quot;,&quot;type&quot;:&quot;comment&quot;,&quot;z&quot;:&quot;3a005176.5f5df6&quot;,&quot;name&quot;:&quot;NLCによる判別&quot;,&quot;info&quot;:&quot;&quot;,&quot;x&quot;:501,&quot;y&quot;:223,&quot;wires&quot;:[]},{&quot;id&quot;:&quot;90dde26e.3c5a6&quot;,&quot;type&quot;:&quot;comment&quot;,&quot;z&quot;:&quot;3a005176.5f5df6&quot;,&quot;name&quot;:&quot;1. 初期ページの表示&quot;,&quot;info&quot;:&quot;&quot;,&quot;x&quot;:111,&quot;y&quot;:63,&quot;wires&quot;:[]},{&quot;id&quot;:&quot;e856fe3d.a60768&quot;,&quot;type&quot;:&quot;debug&quot;,&quot;z&quot;:&quot;3a005176.5f5df6&quot;,&quot;name&quot;:&quot;レスポンス定義のデバッグ&quot;,&quot;active&quot;:false,&quot;console&quot;:&quot;false&quot;,&quot;complete&quot;:&quot;payload&quot;,&quot;x&quot;:931,&quot;y&quot;:483,&quot;wires&quot;:[]},{&quot;id&quot;:&quot;8e2fe5ae.77012&quot;,&quot;type&quot;:&quot;function&quot;,&quot;z&quot;:&quot;3a005176.5f5df6&quot;,&quot;name&quot;:&quot;適合率60%以上のみ採用&quot;,&quot;func&quot;:&quot;var topClass = \&quot;\&quot;;\nvar confidence = \&quot;\&quot;;\nfor(var i=0;i&lt;msg.payload.classes.length;i++){\n    if(msg.payload.classes[i].class_name == msg.payload.top_class) {\n        if(msg.payload.classes[i].confidence &gt; 0.6) {\n            topClass = msg.payload.top_class;\n        }\n        confidence = msg.payload.classes[i].confidence;\n        break;\n    }\n}\nif(topClass===\&quot;\&quot;){\n    msg.payload = \&quot;\&quot;;\n} else {\n    msg.payload = topClass;\n}\ncontext.global.confidence = confidence;\nreturn msg;&quot;,&quot;outputs&quot;:1,&quot;noerr&quot;:0,&quot;x&quot;:751,&quot;y&quot;:263,&quot;wires&quot;:[[&quot;8678583b.5fa33&quot;]]},{&quot;id&quot;:&quot;8678583b.5fa33&quot;,&quot;type&quot;:&quot;switch&quot;,&quot;z&quot;:&quot;3a005176.5f5df6&quot;,&quot;name&quot;:&quot;回答ClassIdの有無&quot;,&quot;property&quot;:&quot;payload.length&quot;,&quot;propertyType&quot;:&quot;msg&quot;,&quot;rules&quot;:[{&quot;t&quot;:&quot;gt&quot;,&quot;v&quot;:&quot;0&quot;,&quot;vt&quot;:&quot;num&quot;},{&quot;t&quot;:&quot;else&quot;}],&quot;checkall&quot;:&quot;true&quot;,&quot;outputs&quot;:2,&quot;x&quot;:271,&quot;y&quot;:363,&quot;wires&quot;:[[&quot;93dbe863.317ff8&quot;],[&quot;8e249832.caeb8&quot;]]},{&quot;id&quot;:&quot;f29f6cd.392951&quot;,&quot;type&quot;:&quot;debug&quot;,&quot;z&quot;:&quot;3a005176.5f5df6&quot;,&quot;name&quot;:&quot;NLCのデバッグ&quot;,&quot;active&quot;:false,&quot;console&quot;:&quot;false&quot;,&quot;complete&quot;:&quot;payload&quot;,&quot;x&quot;:721,&quot;y&quot;:223,&quot;wires&quot;:[]},{&quot;id&quot;:&quot;2992e793.436a7&quot;,&quot;type&quot;:&quot;debug&quot;,&quot;z&quot;:&quot;3a005176.5f5df6&quot;,&quot;name&quot;:&quot;回答取得の確認&quot;,&quot;active&quot;:false,&quot;console&quot;:&quot;false&quot;,&quot;complete&quot;:&quot;payload&quot;,&quot;x&quot;:901,&quot;y&quot;:323,&quot;wires&quot;:[]},{&quot;id&quot;:&quot;bd150fcf.ce83f8&quot;,&quot;type&quot;:&quot;template&quot;,&quot;z&quot;:&quot;3a005176.5f5df6&quot;,&quot;name&quot;:&quot;入力画面&quot;,&quot;field&quot;:&quot;payload&quot;,&quot;fieldType&quot;:&quot;msg&quot;,&quot;format&quot;:&quot;handlebars&quot;,&quot;syntax&quot;:&quot;mustache&quot;,&quot;template&quot;:&quot;&lt;head&gt;\n  &lt;meta charset=\&quot;UTF-8\&quot;&gt;\n  &lt;meta http-equiv=\&quot;X-UA-Compatible\&quot; content=\&quot;IE=edge\&quot;&gt;\n  &lt;meta name=\&quot;viewport\&quot; content=\&quot;width=device-width, initial-scale=1\&quot;&gt;\n\n  &lt;title&gt;Ask Watson Demo&lt;/title&gt;\n  &lt;link href=\&quot;https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css\&quot; rel=\&quot;stylesheet\&quot;&gt;\n  &lt;style type=\&quot;text/css\&quot;&gt;\n\n\n  .bs-component {\n    position: relative;\n  }\n  div#headerArea {\n    position: fixed !important;\n    position: absolute;\n    background-color: #00DD00;\n    color: #FFF;\n    top: 0;\n    height: 50px;\n    left: 0;\n    width: 100%;\n    z-index: 2;\n  }\n  div#conversation_field {\n    padding-left: 10%;\n    padding-right: 10%;\n  }\n  input.btn{\n    background-color: #00DD00;\n    color: #FFFFFF;\n  }\n\n\n  @media ( min-width: 768px ) {\n    body {padding-top: 80px;\n      padding-bottom: 10%;\n\n    }\n    div#footerArea {\n      position: fixed !important;\n      position: absolute;\n      background-color: #FFFFFF;\n      bottom: 0;\n      height: 100px;\n      padding-top: 10px;\n      padding-right: 10%;\n      left: 0;\n      width:  70vw;\n      z-index: 1;\n    }\n    #QuestionText{\n      width:  60vw;\n      margin-left: 1%;\n    }\n  }\n\n  /*モバイル用 Media Queries*/\n  @media screen and (max-width: 768px) {\n    body {padding-top: 80px;\n      padding-bottom: 10%;\n    }\n    #banner {\n      min-height: 70px;\n      border-bottom: none;\n    }\n    div#conversation_field {\n    padding-left: 10%;\n    padding-right: 10%;\n    padding-bottom: 15%;\n  }\n    div#footerArea {\n      position: fixed !important;\n      position: absolute;\n      background-color: #FFFFFF;\n      bottom: 0;\n      height: 100px;\n      padding-top: 0px;\n      padding-right: 0%;\n      left: 0;\n      width: 100%;\n      z-index: 3;\n      background-color: transparent;\n    }\n    div.content{\n      position: absolute;\n      bottom:26%;\n    }\n\n    #QuestionText{\n      width: 86vw;\n      margin-left: 1%;\n    }\n  }\n\n  /* balloon common */\n  div.balloon-wrapper {\n  \twidth: 500px;\n  \tmargin: 15px auto;\n  }\n  div.balloon-wrapper::after {\n  \tclear: both;\n  \tcontent: \&quot;\&quot;;\n  \tdisplay: block;\n  \tline-height: 0;\n  }\n  p.balloon-left,\n  p.balloon-right {\n  \tposition: relative;\n  \tz-index: 1;\n  \tmax-width: 80%;\n  \tmin-width: 10%;\n  \tmargin: 15px auto;\n  \tpadding: 13px;\n  \tbackground-color: #fff;\n  \tborder-width: 3px;\n  \tborder-style: solid;\n  \tborder-radius: 10px;\n  }\n  p.balloon-left::before,\n  p.balloon-right::before {\n  \tcontent: \&quot;\&quot;;\n  \tdisplay: block;\n  \tposition: absolute;\n  \tz-index: 10;\n  \ttop: 10px;\n  \twidth:  0;\n  \theight: 0;\n  \tborder: 15px solid transparent;\n  }\n  p.balloon-left::after,\n  p.balloon-right::after {\n  \tcontent: \&quot;\&quot;;\n  \tdisplay: block;\n  \tposition: absolute;\n  \tz-index: 100;\n  \ttop: 10px;\n  \twidth:  0;\n  \theight: 0;\n  \tborder: 15px solid transparent;\n  }\n\n  /* balloon left */\n  p.balloon-left {\n  \tfloat: left;\n  \tborder-color: #EEEEEE;\n    background-color: #EEEEEE;\n  }\n  p.balloon-left::before {\n  \tleft: -31px;\n  \tborder-right: 15px solid #EEEEEE;\n  }\n  p.balloon-left::after {\n  \tleft: -26px;\n  \tborder-right: 15px solid #EEEEEE;\n  }\n\n  /* balloon right */\n  p.balloon-right {\n  \tfloat: right;\n  \tborder-color: #00DD00;\n  \tbackground-color: #00DD00;\n    color:#ffffff;\n  }\n  p.balloon-right::before {\n  \tright: -31px;\n  \tborder-left: 15px solid #00DD00;\n  }\n  p.balloon-right::after {\n  \tright: -26px;\n  \tborder-left: 15px solid #00DD00;\n  }\n  &lt;/style&gt;\n\n&lt;/head&gt;\n&lt;body style=\&quot;font-family:'Lucida Grande', 'Hiragino Kaku Gothic ProN', 'ヒラギノ角ゴ ProN W3', Meiryo, メイリオ, sans-serif;\&quot;&gt;\n\n  &lt;!-- header\n  ================================================== --&gt;\n  &lt;header&gt;\n      &lt;div class=\&quot;container-fluid\&quot; id=\&quot;headerArea\&quot;&gt;\n        &lt;h4&gt;Ask Watson Demo&lt;/h4&gt;\n      &lt;/div&gt;&lt;!-- /.container-fluid --&gt;\n  &lt;/header&gt;\n\n  &lt;!-- ガイド部分\n  ================================================== --&gt;\n  &lt;div class=\&quot;row\&quot;&gt;\n    &lt;div class=\&quot;col-lg-8 col-md-10 col-sm-12 col-xs-12\&quot;&gt;\n        &lt;div class=\&quot;bs-component\&quot;&gt;\n            &lt;div id=\&quot;conversation_field\&quot;&gt;&lt;/div&gt;\n        &lt;/div&gt;\n    &lt;/div&gt;\n  &lt;/div&gt;\n\n  &lt;!-- Footer箇所\n  ================================================== --&gt;\n  &lt;form id=\&quot;searchFormId\&quot; action=\&quot;#\&quot;&gt;\n  &lt;div class=\&quot;row container-fluid\&quot; id=\&quot;footerArea\&quot;&gt;\n    \t&lt;div class=\&quot;content\&quot;&gt;\n          &lt;table&gt;\n            &lt;tr&gt;\n              &lt;td&gt;&lt;input type=\&quot;text\&quot; class=\&quot;form-control\&quot; id=\&quot;QuestionText\&quot; placeholder=\&quot;ここに質問を入力してください\&quot;&gt;&lt;/td&gt;\n              &lt;td&gt;&lt;input type=\&quot;submit\&quot; value=\&quot;送信\&quot; class=\&quot;btn\&quot; onclick=\&quot;askwatson($('#QuestionText').val());\&quot;&gt;&lt;/button&gt;&lt;/td&gt;\n            &lt;/tr&gt;\n          &lt;/table&gt;\n    \t&lt;/div&gt;\n  &lt;/div&gt;\n  &lt;/form&gt;\n\n  &lt;!-- JavaScript Section\n  ================================================== --&gt;\n  &lt;script src=\&quot;https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js\&quot;&gt;&lt;/script&gt;\n  &lt;script src=\&quot;https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js\&quot;&gt;&lt;/script&gt;\n  &lt;script&gt;\n  var answerNumber = 1;\n  var conversation_id = \&quot;\&quot;;\n  var client_id = \&quot;\&quot;;\n  var dialog=false;\n\n$(function(){\n  setTimeout(function(){\n    document.getElementById(\&quot;conversation_field\&quot;).innerHTML += '&lt;div class=\&quot;row\&quot;&gt;&lt;div class=\&quot;col-xs-11\&quot;&gt;&lt;p class=\&quot;balloon-left\&quot;&gt;契約内容に関するご質問をどうぞ。&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;';\n   },1000);\n  });\n\n  function askwatson(question) {\n    question = question.replace(/\\r?\\n/g,\&quot;\&quot;);\n    question_no_space = question.replace(/\\s/g,\&quot;\&quot;);\n    if(question_no_space != \&quot;\&quot;) {\n        document.getElementById(\&quot;conversation_field\&quot;).innerHTML += '&lt;div class=\&quot;row\&quot;&gt;&lt;div class=\&quot;col-xs-11\&quot;&gt;&lt;p class=\&quot;balloon-right\&quot; id=\&quot;watsonAnswer' + answerNumber + '\&quot;&gt;' + question + '&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;';\n        $('#QuestionText').val(\&quot;\&quot;);\n        $.ajax({\n            url: '/faq',\n            type: \&quot;POST\&quot;,\n            data: {\n                \&quot;input_text\&quot; : question\n            },\n            dataType: 'json',\n        })\n        .done(function(response){\n            if(response.conversation_id != null){\n                conversation_id = response.conversation_id;\n                dialog=true;\n            }\n            var answer = response.response.replace(/\\n/g, \&quot;&lt;br&gt;\&quot;) + '&lt;br&gt;(' + response.confidence + ')';\n            if(response.ref_url!==\&quot;\&quot;) {\n                answer += '&lt;br&gt;&lt;br&gt;&lt;a href=\&quot;'+response.ref_url+'\&quot; target=\&quot;_blank\&quot;&gt;'+response.ref_url+'&lt;/a&gt;';\n            }\n            document.getElementById(\&quot;conversation_field\&quot;).innerHTML += '&lt;div class=\&quot;row\&quot;&gt;&lt;div class=\&quot;col-xs-11\&quot;&gt;&lt;p class=\&quot;balloon-left\&quot;&gt;' + answer + '&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;';\n            document.getElementById(\&quot;watsonAnswer\&quot; + answerNumber).scrollIntoView(true);\n            document.getElementById(\&quot;QuestionText\&quot;).focus();\n            $('#QuestionText').val(\&quot;\&quot;);\n            answerNumber++;\n        })\n        .fail(function( jqXHR, textStatus, errorThrown ){\n            document.getElementById(\&quot;conversation_field\&quot;).innerHTML += '&lt;div class=\&quot;row\&quot;&gt;&lt;div class=\&quot;col-xs-11\&quot;&gt;&lt;p class=\&quot;balloon-left\&quot;&gt;' + \&quot;申し訳ございません。データに不備があります。\&quot; + '&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;';\n        });\n\n    }\n    $('#searchFormId').on('submit', function() {\n        var question = $('#QuestionText').val();\n        askwatson(question);\n        return false;\n    });\n  }\n  &lt;/script&gt;\n&lt;/body&gt;\n&quot;,&quot;x&quot;:281,&quot;y&quot;:103,&quot;wires&quot;:[[&quot;6b314712.480338&quot;]]}]
<br>
<font color="red"><b>========================= ↑ここまで↑ =========================</b></font><br>
<br><br>
<b>&lt;Flow 3 : 原状回復&gt;</b><br>
<font color="red"><b>========================= ↓ここから↓ =========================</b></font><br>
[{&quot;id&quot;:&quot;a9fc2aa8.bb1878&quot;,&quot;type&quot;:&quot;comment&quot;,&quot;z&quot;:&quot;d79dc37c.c5f048&quot;,&quot;name&quot;:&quot;9. 登録データをクリアする&quot;,&quot;info&quot;:&quot;&quot;,&quot;x&quot;:163,&quot;y&quot;:57.5,&quot;wires&quot;:[]},{&quot;id&quot;:&quot;2781779f.a03988&quot;,&quot;type&quot;:&quot;inject&quot;,&quot;z&quot;:&quot;d79dc37c.c5f048&quot;,&quot;name&quot;:&quot;回答データクリア&quot;,&quot;topic&quot;:&quot;&quot;,&quot;payload&quot;:&quot;&quot;,&quot;payloadType&quot;:&quot;date&quot;,&quot;repeat&quot;:&quot;&quot;,&quot;crontab&quot;:&quot;&quot;,&quot;once&quot;:false,&quot;x&quot;:169,&quot;y&quot;:160.5,&quot;wires&quot;:[[&quot;7138b4f7.c765f4&quot;]]},{&quot;id&quot;:&quot;7138b4f7.c765f4&quot;,&quot;type&quot;:&quot;cloudant in&quot;,&quot;z&quot;:&quot;d79dc37c.c5f048&quot;,&quot;name&quot;:&quot;全件取得&quot;,&quot;cloudant&quot;:&quot;&quot;,&quot;database&quot;:&quot;faq-answer&quot;,&quot;service&quot;:&quot;faq-demo-cloudantNoSQLDB&quot;,&quot;search&quot;:&quot;_all_&quot;,&quot;design&quot;:&quot;&quot;,&quot;index&quot;:&quot;&quot;,&quot;x&quot;:366,&quot;y&quot;:159.5,&quot;wires&quot;:[[&quot;277e8ba2.9843a4&quot;]]},{&quot;id&quot;:&quot;1bb546ce.b13261&quot;,&quot;type&quot;:&quot;switch&quot;,&quot;z&quot;:&quot;d79dc37c.c5f048&quot;,&quot;name&quot;:&quot;&quot;,&quot;property&quot;:&quot;payload&quot;,&quot;propertyType&quot;:&quot;msg&quot;,&quot;rules&quot;:[{&quot;t&quot;:&quot;eq&quot;,&quot;v&quot;:&quot;0&quot;,&quot;vt&quot;:&quot;num&quot;},{&quot;t&quot;:&quot;gt&quot;,&quot;v&quot;:&quot;0&quot;,&quot;vt&quot;:&quot;num&quot;}],&quot;checkall&quot;:&quot;true&quot;,&quot;outputs&quot;:2,&quot;x&quot;:578,&quot;y&quot;:153,&quot;wires&quot;:[[&quot;f5f09a6.babc5e8&quot;],[&quot;b3339e5e.7c66e8&quot;]]},{&quot;id&quot;:&quot;277e8ba2.9843a4&quot;,&quot;type&quot;:&quot;function&quot;,&quot;z&quot;:&quot;d79dc37c.c5f048&quot;,&quot;name&quot;:&quot;キー抽出&quot;,&quot;func&quot;:&quot;context.global.payload=msg.payload;\nmsg.payload = context.global.payload.length;\ncontext.global.count = context.global.payload.length;\ncontext.global.unitCnt = 0;\nreturn msg;\n&quot;,&quot;outputs&quot;:1,&quot;noerr&quot;:0,&quot;x&quot;:463,&quot;y&quot;:84,&quot;wires&quot;:[[&quot;1bb546ce.b13261&quot;]]},{&quot;id&quot;:&quot;b3339e5e.7c66e8&quot;,&quot;type&quot;:&quot;function&quot;,&quot;z&quot;:&quot;d79dc37c.c5f048&quot;,&quot;name&quot;:&quot;1件削除&quot;,&quot;func&quot;:&quot;msg.payload = context.global.payload[context.global.count-1];\ncontext.global.count = context.global.count - 1;\ncontext.global.unitCnt += 1;\nreturn msg;&quot;,&quot;outputs&quot;:1,&quot;noerr&quot;:0,&quot;x&quot;:753,&quot;y&quot;:160,&quot;wires&quot;:[[&quot;3a218ff7.d93dc&quot;,&quot;51f6a29e.923f7c&quot;]]},{&quot;id&quot;:&quot;3a218ff7.d93dc&quot;,&quot;type&quot;:&quot;cloudant out&quot;,&quot;z&quot;:&quot;d79dc37c.c5f048&quot;,&quot;name&quot;:&quot;&quot;,&quot;cloudant&quot;:&quot;&quot;,&quot;database&quot;:&quot;faq-answer&quot;,&quot;service&quot;:&quot;faq-demo-cloudantNoSQLDB&quot;,&quot;payonly&quot;:false,&quot;operation&quot;:&quot;delete&quot;,&quot;x&quot;:937,&quot;y&quot;:101.5,&quot;wires&quot;:[]},{&quot;id&quot;:&quot;51f6a29e.923f7c&quot;,&quot;type&quot;:&quot;delay&quot;,&quot;z&quot;:&quot;d79dc37c.c5f048&quot;,&quot;name&quot;:&quot;&quot;,&quot;pauseType&quot;:&quot;delay&quot;,&quot;timeout&quot;:&quot;110&quot;,&quot;timeoutUnits&quot;:&quot;milliseconds&quot;,&quot;rate&quot;:&quot;1&quot;,&quot;nbRateUnits&quot;:&quot;1&quot;,&quot;rateUnits&quot;:&quot;second&quot;,&quot;randomFirst&quot;:&quot;1&quot;,&quot;randomLast&quot;:&quot;5&quot;,&quot;randomUnits&quot;:&quot;seconds&quot;,&quot;drop&quot;:false,&quot;x&quot;:575,&quot;y&quot;:315,&quot;wires&quot;:[[&quot;ff716d3.beec59&quot;]]},{&quot;id&quot;:&quot;ff716d3.beec59&quot;,&quot;type&quot;:&quot;function&quot;,&quot;z&quot;:&quot;d79dc37c.c5f048&quot;,&quot;name&quot;:&quot;Fetch&quot;,&quot;func&quot;:&quot;msg.payload = context.global.count;\nreturn msg;&quot;,&quot;outputs&quot;:1,&quot;noerr&quot;:0,&quot;x&quot;:746,&quot;y&quot;:318,&quot;wires&quot;:[[&quot;1bb546ce.b13261&quot;]]},{&quot;id&quot;:&quot;f5f09a6.babc5e8&quot;,&quot;type&quot;:&quot;debug&quot;,&quot;z&quot;:&quot;d79dc37c.c5f048&quot;,&quot;name&quot;:&quot;&quot;,&quot;active&quot;:true,&quot;console&quot;:&quot;false&quot;,&quot;complete&quot;:&quot;false&quot;,&quot;x&quot;:685,&quot;y&quot;:72,&quot;wires&quot;:[]}]
<br>
<font color="red"><b>========================= ↑ここまで↑ =========================</b></font><br>
</body>
</html>
