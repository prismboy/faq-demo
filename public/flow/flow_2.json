<<<<<<< HEAD
[{"id":"e551bd1c.eb651","type":"http in","z":"10a62df9.7fe222","name":"","url":"/faq","method":"get","swaggerDoc":"","x":80,"y":80,"wires":[["2657705c.981cf8"]]},{"id":"cfa54cfc.c292e","type":"http response","z":"10a62df9.7fe222","name":"","x":470,"y":80,"wires":[]},{"id":"ba64d596.a0f88","type":"comment","z":"10a62df9.7fe222","name":"3. ユーザーからの入力受け付け","info":"","x":140,"y":180,"wires":[]},{"id":"6a933e95.2d6898","type":"http in","z":"10a62df9.7fe222","name":"","url":"/faq","method":"post","swaggerDoc":"","x":80,"y":240,"wires":[["4ad74084.686fd"]]},{"id":"fcf43674.d62f58","type":"function","z":"10a62df9.7fe222","name":"データの形式","func":"if(msg.payload.length !== 0){\n    msg.answer = msg.payload[0].answer.replace(/¥n/g,\"<br/>\");\n    msg.ref_url = JSON.stringify(msg.payload[0].ref_url);\n}else{\n    msg.answer = '申し訳ございません。回答が見つかりません。';\n    msg.ref_url = \"[]\";\n}\nmsg.confidence = Math.round(context.global.confidence*100)/100;\n\nreturn msg;","outputs":1,"noerr":0,"x":490,"y":420,"wires":[["3899fdb9.276d32"]]},{"id":"3899fdb9.276d32","type":"template","z":"10a62df9.7fe222","name":"レスポンスの定義","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{\n    \"response\" : \"{{{answer}}}\",\n    \"confidence\" : \"{{confidence}}\",\n    \"ref_url\" : {{{ref_url}}}\n}","x":690,"y":420,"wires":[["751335e2.83c114","cce10c27.ac8ef"]]},{"id":"751335e2.83c114","type":"http response","z":"10a62df9.7fe222","name":"","x":870,"y":420,"wires":[]},{"id":"5b3d1d5d.f86004","type":"cloudant in","z":"10a62df9.7fe222","name":"","cloudant":"","database":"faq-answer","service":"710-o900156-d-house-blmx-sample-cloudantNoSQLDB","search":"_idx_","design":"index","index":"byClassName","x":710,"y":340,"wires":[["fcf43674.d62f58","950149c.ab37d38"]]},{"id":"b786a8e9.3626a8","type":"watson-natural-language-classifier","z":"10a62df9.7fe222","name":"質問内容判定","mode":"classify","language":"en","classifier":"f5bbbbx174-nlc-7936","x":500,"y":240,"wires":[["b8fe1c3b.aceb08","dff5e1f1.26d2d8"]]},{"id":"4ad74084.686fd","type":"function","z":"10a62df9.7fe222","name":"入力テキスト受け渡し","func":"context.global.input_text =  msg.payload.input_text;\nmsg.payload = msg.payload.input_text;\nreturn msg;","outputs":1,"noerr":0,"x":280,"y":240,"wires":[["b786a8e9.3626a8"]]},{"id":"12652e96.0f5aa1","type":"function","z":"10a62df9.7fe222","name":"回答クラスのセット","func":"msg.payload = \"class_name:\" + msg.payload;\nreturn msg;","outputs":1,"noerr":0,"x":510,"y":340,"wires":[["5b3d1d5d.f86004"]]},{"id":"6407ac23.eb4544","type":"comment","z":"10a62df9.7fe222","name":"NLCによる判別","info":"","x":500,"y":200,"wires":[]},{"id":"3dd27cbb.eccfec","type":"comment","z":"10a62df9.7fe222","name":"2. 初期ページの表示","info":"","x":110,"y":40,"wires":[]},{"id":"cce10c27.ac8ef","type":"debug","z":"10a62df9.7fe222","name":"レスポンス定義のデバッグ","active":false,"console":"false","complete":"payload","x":930,"y":460,"wires":[]},{"id":"b8fe1c3b.aceb08","type":"function","z":"10a62df9.7fe222","name":"適合率60%以上のみ採用","func":"var topClass = \"\";\nvar confidence = \"\";\nfor(var i=0;i<msg.payload.classes.length;i++){\n    if(msg.payload.classes[i].class_name == msg.payload.top_class) {\n        if(msg.payload.classes[i].confidence > 0.6) {\n            topClass = msg.payload.top_class;\n        }\n        confidence = msg.payload.classes[i].confidence;\n        break;\n    }\n}\nif(topClass===\"\"){\n    msg.payload = \"\";\n} else {\n    msg.payload = topClass;\n}\ncontext.global.confidence = confidence;\nreturn msg;","outputs":1,"noerr":0,"x":750,"y":240,"wires":[["f868eb30.55e87"]]},{"id":"f868eb30.55e87","type":"switch","z":"10a62df9.7fe222","name":"回答ClassIdの有無","property":"payload.length","propertyType":"msg","rules":[{"t":"gt","v":"0","vt":"num"},{"t":"else"}],"checkall":"true","outputs":2,"x":270,"y":340,"wires":[["12652e96.0f5aa1"],["fcf43674.d62f58"]]},{"id":"dff5e1f1.26d2d8","type":"debug","z":"10a62df9.7fe222","name":"NLCのデバッグ","active":false,"console":"false","complete":"payload","x":720,"y":200,"wires":[]},{"id":"950149c.ab37d38","type":"debug","z":"10a62df9.7fe222","name":"回答取得の確認","active":false,"console":"false","complete":"payload","x":900,"y":300,"wires":[]},{"id":"2657705c.981cf8","type":"template","z":"10a62df9.7fe222","name":"入力画面","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n\n  <title>Ask Watson Demo</title>\n  <link href=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css\" rel=\"stylesheet\">\n  <style type=\"text/css\">\n\n\n  .bs-component {\n    position: relative;\n  }\n  div#headerArea {\n    position: fixed !important;\n    position: absolute;\n    background-color: #466BB0;\n    color: #FFF;\n    top: 0;\n    height: 50px;\n    left: 0;\n    width: 100%;\n    z-index: 2;\n  }\n  div#conversation_field {\n    padding-left: 10%;\n    padding-right: 10%;\n  }\n  input.btn{\n    background-color: #466BB0;\n    color: #FFFFFF;\n  }\n\n\n  @media ( min-width: 768px ) {\n    body {padding-top: 80px;\n      padding-bottom: 10%;\n\n    }\n    div#footerArea {\n      position: fixed !important;\n      position: absolute;\n      background-color: #FFFFFF;\n      bottom: 0;\n      height: 100px;\n      padding-top: 10px;\n      padding-right: 10%;\n      left: 0;\n      width:  70vw;\n      z-index: 1;\n    }\n    #QuestionText{\n      width:  60vw;\n      margin-left: 1%;\n    }\n  }\n\n  /*モバイル用 Media Queries*/\n  @media screen and (max-width: 768px) {\n    body {padding-top: 80px;\n      padding-bottom: 10%;\n    }\n    #banner {\n      min-height: 70px;\n      border-bottom: none;\n    }\n    div#conversation_field {\n    padding-left: 10%;\n    padding-right: 10%;\n    padding-bottom: 15%;\n  }\n    div#footerArea {\n      position: fixed !important;\n      position: absolute;\n      background-color: #FFFFFF;\n      bottom: 0;\n      height: 100px;\n      padding-top: 0px;\n      padding-right: 0%;\n      left: 0;\n      width: 100%;\n      z-index: 3;\n      background-color: transparent;\n    }\n    div.content{\n      position: absolute;\n      bottom:26%;\n    }\n\n    #QuestionText{\n      width: 86vw;\n      margin-left: 1%;\n    }\n  }\n\n  /* balloon common */\n  div.balloon-wrapper {\n  \twidth: 500px;\n  \tmargin: 15px auto;\n  }\n  div.balloon-wrapper::after {\n  \tclear: both;\n  \tcontent: \"\";\n  \tdisplay: block;\n  \tline-height: 0;\n  }\n  p.balloon-left,\n  p.balloon-right {\n  \tposition: relative;\n  \tz-index: 1;\n  \tmax-width: 80%;\n  \tmin-width: 10%;\n  \tmargin: 15px auto;\n  \tpadding: 13px;\n  \tbackground-color: #fff;\n  \tborder-width: 3px;\n  \tborder-style: solid;\n  \tborder-radius: 10px;\n  }\n  p.balloon-left::before,\n  p.balloon-right::before {\n  \tcontent: \"\";\n  \tdisplay: block;\n  \tposition: absolute;\n  \tz-index: 10;\n  \ttop: 10px;\n  \twidth:  0;\n  \theight: 0;\n  \tborder: 15px solid transparent;\n  }\n  p.balloon-left::after,\n  p.balloon-right::after {\n  \tcontent: \"\";\n  \tdisplay: block;\n  \tposition: absolute;\n  \tz-index: 100;\n  \ttop: 10px;\n  \twidth:  0;\n  \theight: 0;\n  \tborder: 15px solid transparent;\n  }\n\n  /* balloon left */\n  p.balloon-left {\n  \tfloat: left;\n  \tborder-color: #EEEEEE;\n    background-color: #EEEEEE;\n  }\n  p.balloon-left::before {\n  \tleft: -31px;\n  \tborder-right: 15px solid #EEEEEE;\n  }\n  p.balloon-left::after {\n  \tleft: -26px;\n  \tborder-right: 15px solid #EEEEEE;\n  }\n\n  /* balloon right */\n  p.balloon-right {\n  \tfloat: right;\n  \tborder-color: #466BB0;\n  \tbackground-color: #466BB0;\n    color:#ffffff;\n  }\n  p.balloon-right::before {\n  \tright: -31px;\n  \tborder-left: 15px solid #466BB0;\n  }\n  p.balloon-right::after {\n  \tright: -26px;\n  \tborder-left: 15px solid #466BB0;\n  }\n  </style>\n\n</head>\n<body style=\"font-family:'Lucida Grande', 'Hiragino Kaku Gothic ProN', 'ヒラギノ角ゴ ProN W3', Meiryo, メイリオ, sans-serif;\">\n\n  <!-- header\n  ================================================== -->\n  <header>\n      <div class=\"container-fluid\" id=\"headerArea\">\n        <h4>Ask Watson Demo</h4>\n      </div><!-- /.container-fluid -->\n  </header>\n\n  <!-- ガイド部分\n  ================================================== -->\n  <div class=\"row\">\n    <div class=\"col-lg-8 col-md-10 col-sm-12 col-xs-12\">\n        <div class=\"bs-component\">\n            <div id=\"conversation_field\"></div>\n        </div>\n    </div>\n  </div>\n\n  <!-- Footer箇所\n  ================================================== -->\n  <form id=\"searchFormId\" action=\"#\">\n  <div class=\"row container-fluid\" id=\"footerArea\">\n    \t<div class=\"content\">\n          <table>\n            <tr>\n              <td><input type=\"text\" class=\"form-control\" id=\"QuestionText\" placeholder=\"ここに質問を入力してください\"></td>\n              <td><input type=\"submit\" value=\"送信\" class=\"btn\" onclick=\"askwatson($('#QuestionText').val());\"></button></td>\n            </tr>\n          </table>\n    \t</div>\n  </div>\n  </form>\n\n  <!-- JavaScript Section\n  ================================================== -->\n  <script src=\"https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js\"></script>\n  <script src=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js\"></script>\n  <script>\n  var answerNumber = 1;\n  var conversation_id = \"\";\n  var client_id = \"\";\n  var dialog=false;\n\n$(function(){\n  setTimeout(function(){\n    document.getElementById(\"conversation_field\").innerHTML += '<div class=\"row\"><div class=\"col-xs-11\"><p class=\"balloon-left\">IBM Watsonです。ご質問をどうぞ。</p></div></div>';\n   },1000);\n  });\n\n  function askwatson(question) {\n    question = question.replace(/\\r?\\n/g,\"\");\n    question_no_space = question.replace(/\\s/g,\"\");\n    if(question_no_space != \"\") {\n        document.getElementById(\"conversation_field\").innerHTML += '<div class=\"row\"><div class=\"col-xs-11\"><p class=\"balloon-right\" id=\"watsonAnswer' + answerNumber + '\">' + question + '</p></div></div>';\n        $('#QuestionText').val(\"\");\n        $.ajax({\n            url: '/faq',\n            type: \"POST\",\n            data: {\n                \"input_text\" : question\n            },\n            dataType: 'json',\n        })\n        .done(function(response){\n            if(response.conversation_id != null){\n                conversation_id = response.conversation_id;\n                dialog=true;\n            }\n            var answer = response.response.replace(/\\n/g, \"<br>\") + '<br>(' + response.confidence + ')';\n            if(response.ref_url.length>0) {\n                answer += '<br>';\n                for(var i=0;i<response.ref_url.length;i++) {\n                    answer += '<br><a href=\"'+response.ref_url[i].url+'\" target=\"_blank\">'+response.ref_url[i].title+'</a>';\n                }\n            }\n            document.getElementById(\"conversation_field\").innerHTML += '<div class=\"row\"><div class=\"col-xs-11\"><p class=\"balloon-left\">' + answer + '</p></div></div>';\n            document.getElementById(\"watsonAnswer\" + answerNumber).scrollIntoView(true);\n            document.getElementById(\"QuestionText\").focus();\n            $('#QuestionText').val(\"\");\n            answerNumber++;\n        })\n        .fail(function( jqXHR, textStatus, errorThrown ){\n            document.getElementById(\"conversation_field\").innerHTML += '<div class=\"row\"><div class=\"col-xs-11\"><p class=\"balloon-left\">' + \"申し訳ございません。データに不備があります。\" + '</p></div></div>';\n            document.getElementById(\"watsonAnswer\" + answerNumber).scrollIntoView(true);\n            document.getElementById(\"QuestionText\").focus();\n            $('#QuestionText').val(\"\");\n            answerNumber++;\n        });\n\n    }\n    $('#searchFormId').on('submit', function() {\n        var question = $('#QuestionText').val();\n        askwatson(question);\n        return false;\n    });\n  }\n  </script>\n</body>\n","x":280,"y":80,"wires":[["cfa54cfc.c292e"]]}]
=======
[{"id":"6060aadb.84d644","type":"http in","z":"3a005176.5f5df6","name":"","url":"/faq","method":"get","swaggerDoc":"","x":81,"y":103,"wires":[["bd150fcf.ce83f8"]]},{"id":"6b314712.480338","type":"http response","z":"3a005176.5f5df6","name":"","x":471,"y":103,"wires":[]},{"id":"7d8182d7.e6529c","type":"comment","z":"3a005176.5f5df6","name":"3. ユーザーからの入力受け付け","info":"","x":141,"y":203,"wires":[]},{"id":"7d783be7.c2ed6c","type":"http in","z":"3a005176.5f5df6","name":"","url":"/faq","method":"post","swaggerDoc":"","x":81,"y":263,"wires":[["5f42a286.73ddac"]]},{"id":"8e249832.caeb8","type":"function","z":"3a005176.5f5df6","name":"データの形式","func":"if(msg.payload.length !== 0){\n    msg.answer = msg.payload[0].answer; // .replace(/\\\\n/g,\"<br />\");\n    msg.ref_url = msg.payload[0].ref_url;\n}else{\n    msg.answer = '申し訳ございません。回答が見つかりません。';\n    msg.ref_url = \"\";\n}\nmsg.confidence = Math.round(context.global.confidence*100)/100;\n\nreturn msg;","outputs":1,"noerr":0,"x":491,"y":443,"wires":[["5b273f6.865a34"]]},{"id":"5b273f6.865a34","type":"template","z":"3a005176.5f5df6","name":"レスポンスの定義","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{\n    \"response\" : \"{{answer}}\",\n    \"confidence\" : \"{{confidence}}\",\n    \"ref_url\" : \"{{ref_url}}\"\n}","x":691,"y":443,"wires":[["6333a4ed.943d2c","e856fe3d.a60768"]]},{"id":"6333a4ed.943d2c","type":"http response","z":"3a005176.5f5df6","name":"","x":871,"y":443,"wires":[]},{"id":"6955fd67.114c7c","type":"cloudant in","z":"3a005176.5f5df6","name":"","cloudant":"","database":"faq-answer","service":"","search":"_idx_","design":"index","index":"byClassName","x":711,"y":363,"wires":[["8e249832.caeb8","2992e793.436a7"]]},{"id":"79c4fd25.aa9014","type":"watson-natural-language-classifier","z":"3a005176.5f5df6","name":"質問内容判定","mode":"classify","language":"en","classifier":"","x":501,"y":263,"wires":[["8e2fe5ae.77012","f29f6cd.392951"]]},{"id":"5f42a286.73ddac","type":"function","z":"3a005176.5f5df6","name":"入力テキスト受け渡し","func":"context.global.input_text =  msg.payload.input_text;\nmsg.payload = msg.payload.input_text;\nreturn msg;","outputs":1,"noerr":0,"x":281,"y":263,"wires":[["79c4fd25.aa9014"]]},{"id":"93dbe863.317ff8","type":"function","z":"3a005176.5f5df6","name":"回答クラスのセット","func":"msg.payload = \"class_name:\" + msg.payload;\nreturn msg;","outputs":1,"noerr":0,"x":511,"y":363,"wires":[["6955fd67.114c7c"]]},{"id":"f3eac1a5.ec332","type":"comment","z":"3a005176.5f5df6","name":"NLCによる判別","info":"","x":501,"y":223,"wires":[]},{"id":"90dde26e.3c5a6","type":"comment","z":"3a005176.5f5df6","name":"2. 初期ページの表示","info":"","x":111,"y":63,"wires":[]},{"id":"e856fe3d.a60768","type":"debug","z":"3a005176.5f5df6","name":"レスポンス定義のデバッグ","active":true,"console":"false","complete":"payload","x":931,"y":483,"wires":[]},{"id":"8e2fe5ae.77012","type":"function","z":"3a005176.5f5df6","name":"適合率60%以上のみ採用","func":"var topClass = \"\";\nvar confidence = \"\";\nfor(var i=0;i<msg.payload.classes.length;i++){\n    if(msg.payload.classes[i].class_name == msg.payload.top_class) {\n        if(msg.payload.classes[i].confidence > 0.6) {\n            topClass = msg.payload.top_class;\n        }\n        confidence = msg.payload.classes[i].confidence;\n        break;\n    }\n}\nif(topClass===\"\"){\n    msg.payload = \"\";\n} else {\n    msg.payload = topClass;\n}\ncontext.global.confidence = confidence;\nreturn msg;","outputs":1,"noerr":0,"x":751,"y":263,"wires":[["8678583b.5fa33"]]},{"id":"8678583b.5fa33","type":"switch","z":"3a005176.5f5df6","name":"回答ClassIdの有無","property":"payload.length","propertyType":"msg","rules":[{"t":"gt","v":"0","vt":"num"},{"t":"else"}],"checkall":"true","outputs":2,"x":271,"y":363,"wires":[["93dbe863.317ff8"],["8e249832.caeb8"]]},{"id":"f29f6cd.392951","type":"debug","z":"3a005176.5f5df6","name":"NLCのデバッグ","active":false,"console":"false","complete":"payload","x":721,"y":223,"wires":[]},{"id":"2992e793.436a7","type":"debug","z":"3a005176.5f5df6","name":"回答取得の確認","active":false,"console":"false","complete":"payload","x":901,"y":323,"wires":[]},{"id":"bd150fcf.ce83f8","type":"template","z":"3a005176.5f5df6","name":"入力画面","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<head>\n  <meta charset=\"UTF-8\">\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n\n  <title>FAQ Demo</title>\n  <link href=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css\" rel=\"stylesheet\">\n  <style type=\"text/css\">\n\n\n  .bs-component {\n    position: relative;\n  }\n  div#headerArea {\n    position: fixed !important;\n    position: absolute;\n    background-color: #466BB0;\n    color: #FFF;\n    top: 0;\n    height: 50px;\n    left: 0;\n    width: 100%;\n    z-index: 2;\n  }\n  div#conversation_field {\n    padding-left: 10%;\n    padding-right: 10%;\n  }\n  input.btn{\n    background-color: #466BB0;\n    color: #FFFFFF;\n  }\n\n\n  @media ( min-width: 768px ) {\n    body {padding-top: 80px;\n      padding-bottom: 10%;\n\n    }\n    div#footerArea {\n      position: fixed !important;\n      position: absolute;\n      background-color: #FFFFFF;\n      bottom: 0;\n      height: 100px;\n      padding-top: 10px;\n      padding-right: 10%;\n      left: 0;\n      width:  70vw;\n      z-index: 1;\n    }\n    #QuestionText{\n      width:  60vw;\n      margin-left: 1%;\n    }\n  }\n\n  /*モバイル用 Media Queries*/\n  @media screen and (max-width: 768px) {\n    body {padding-top: 80px;\n      padding-bottom: 10%;\n    }\n    #banner {\n      min-height: 70px;\n      border-bottom: none;\n    }\n    div#conversation_field {\n    padding-left: 10%;\n    padding-right: 10%;\n    padding-bottom: 15%;\n  }\n    div#footerArea {\n      position: fixed !important;\n      position: absolute;\n      background-color: #FFFFFF;\n      bottom: 0;\n      height: 100px;\n      padding-top: 0px;\n      padding-right: 0%;\n      left: 0;\n      width: 100%;\n      z-index: 3;\n      background-color: transparent;\n    }\n    div.content{\n      position: absolute;\n      bottom:26%;\n    }\n\n    #QuestionText{\n      width: 86vw;\n      margin-left: 1%;\n    }\n  }\n\n  /* balloon common */\n  div.balloon-wrapper {\n  \twidth: 500px;\n  \tmargin: 15px auto;\n  }\n  div.balloon-wrapper::after {\n  \tclear: both;\n  \tcontent: \"\";\n  \tdisplay: block;\n  \tline-height: 0;\n  }\n  p.balloon-left,\n  p.balloon-right {\n  \tposition: relative;\n  \tz-index: 1;\n  \tmax-width: 80%;\n  \tmin-width: 10%;\n  \tmargin: 15px auto;\n  \tpadding: 13px;\n  \tbackground-color: #fff;\n  \tborder-width: 3px;\n  \tborder-style: solid;\n  \tborder-radius: 10px;\n  }\n  p.balloon-left::before,\n  p.balloon-right::before {\n  \tcontent: \"\";\n  \tdisplay: block;\n  \tposition: absolute;\n  \tz-index: 10;\n  \ttop: 10px;\n  \twidth:  0;\n  \theight: 0;\n  \tborder: 15px solid transparent;\n  }\n  p.balloon-left::after,\n  p.balloon-right::after {\n  \tcontent: \"\";\n  \tdisplay: block;\n  \tposition: absolute;\n  \tz-index: 100;\n  \ttop: 10px;\n  \twidth:  0;\n  \theight: 0;\n  \tborder: 15px solid transparent;\n  }\n\n  /* balloon left */\n  p.balloon-left {\n  \tfloat: left;\n  \tborder-color: #EEEEEE;\n    background-color: #EEEEEE;\n  }\n  p.balloon-left::before {\n  \tleft: -31px;\n  \tborder-right: 15px solid #EEEEEE;\n  }\n  p.balloon-left::after {\n  \tleft: -26px;\n  \tborder-right: 15px solid #EEEEEE;\n  }\n\n  /* balloon right */\n  p.balloon-right {\n  \tfloat: right;\n  \tborder-color: #466BB0;\n  \tbackground-color: #466BB0;\n    color:#ffffff;\n  }\n  p.balloon-right::before {\n  \tright: -31px;\n  \tborder-left: 15px solid #466BB0;\n  }\n  p.balloon-right::after {\n  \tright: -26px;\n  \tborder-left: 15px solid #466BB0;\n  }\n  </style>\n\n</head>\n<body style=\"font-family:'Lucida Grande', 'Hiragino Kaku Gothic ProN', 'ヒラギノ角ゴ ProN W3', Meiryo, メイリオ, sans-serif;\">\n\n  <!-- header\n  ================================================== -->\n  <header>\n      <div class=\"container-fluid\" id=\"headerArea\">\n        <h4>FAQ Demo (IBM Watson Natural Language Classifier)</h4>\n      </div><!-- /.container-fluid -->\n  </header>\n\n  <!-- ガイド部分\n  ================================================== -->\n  <div class=\"row\">\n    <div class=\"col-lg-8 col-md-10 col-sm-12 col-xs-12\">\n        <div class=\"bs-component\">\n            <div id=\"conversation_field\"></div>\n        </div>\n    </div>\n  </div>\n\n  <!-- Footer箇所\n  ================================================== -->\n  <form id=\"searchFormId\" action=\"#\">\n  <div class=\"row container-fluid\" id=\"footerArea\">\n    \t<div class=\"content\">\n          <table>\n            <tr>\n              <td><input type=\"text\" class=\"form-control\" id=\"QuestionText\" placeholder=\"ここに質問を入力してください\"></td>\n              <td><input type=\"submit\" value=\"送信\" class=\"btn\" onclick=\"askwatson($('#QuestionText').val());\"></button></td>\n            </tr>\n          </table>\n    \t</div>\n  </div>\n  </form>\n\n  <!-- JavaScript Section\n  ================================================== -->\n  <script src=\"https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js\"></script>\n  <script src=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js\"></script>\n  <script>\n  var answerNumber = 1;\n  var conversation_id = \"\";\n  var client_id = \"\";\n  var dialog=false;\n\n$(function(){\n  setTimeout(function(){\n    document.getElementById(\"conversation_field\").innerHTML += '<div class=\"row\"><div class=\"col-xs-11\"><p class=\"balloon-left\">IBM Watsonです。ご質問をどうぞ。</p></div></div>';\n   },1000);\n  });\n\n  function askwatson(question) {\n    question = question.replace(/\\r?\\n/g,\"\");\n    question_no_space = question.replace(/\\s/g,\"\");\n    if(question_no_space != \"\") {\n        document.getElementById(\"conversation_field\").innerHTML += '<div class=\"row\"><div class=\"col-xs-11\"><p class=\"balloon-right\" id=\"watsonAnswer' + answerNumber + '\">' + question + '</p></div></div>';\n        $('#QuestionText').val(\"\");\n        $.ajax({\n            url: '/faq',\n            type: \"POST\",\n            data: {\n                \"input_text\" : question\n            },\n            dataType: 'json',\n        })\n        .done(function(response){\n            if(response.conversation_id != null){\n                conversation_id = response.conversation_id;\n                dialog=true;\n            }\n            var answer = response.response.replace(/\\n/g, \"<br>\") + '<br>(' + response.confidence + ')';\n            if(response.ref_url!==\"\") {\n                answer += '<br><br><a href=\"'+response.ref_url+'\" target=\"_blank\">'+response.ref_url+'</a>';\n            }\n            document.getElementById(\"conversation_field\").innerHTML += '<div class=\"row\"><div class=\"col-xs-11\"><p class=\"balloon-left\">' + answer + '</p></div></div>';\n            document.getElementById(\"watsonAnswer\" + answerNumber).scrollIntoView(true);\n            document.getElementById(\"QuestionText\").focus();\n            $('#QuestionText').val(\"\");\n            answerNumber++;\n        })\n        .fail(function( jqXHR, textStatus, errorThrown ){\n            document.getElementById(\"conversation_field\").innerHTML += '<div class=\"row\"><div class=\"col-xs-11\"><p class=\"balloon-left\">' + \"申し訳ございません。データに不備があります。\" + '</p></div></div>';\n        });\n\n    }\n    $('#searchFormId').on('submit', function() {\n        var question = $('#QuestionText').val();\n        askwatson(question);\n        return false;\n    });\n  }\n  </script>\n</body>\n","x":281,"y":103,"wires":[["6b314712.480338"]]}]
>>>>>>> origin/master
